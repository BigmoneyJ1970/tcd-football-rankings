<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Top 10</title>
<style>
  :root{
    --bar-h:32px;
    --bg:#f5f7fa;
    --fg:#000;
  }
  /* reset-ish */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font:600 16px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{
    height:var(--bar-h);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0 8px;
    overflow:hidden;
    white-space:nowrap;
  }
  ol{
    display:flex;
    gap:20px;            /* space between teams */
    list-style:none;
    padding:0;
    margin:0;
    width:100%;
    justify-content:space-between;
  }
  li{display:flex;gap:.35em;align-items:baseline}
  .rk{opacity:.85}
  .team{font-weight:700}

  /* font size derived from height */
  .wrap{font-size:clamp(12px, calc((var(--bar-h) - 10px)), 22px)}
  .rk{font-size:.95em}

  /* LSU special: gold text with purple outline per letter */
  li[data-team="LSU"] .team{
    color:#FDBB30; /* gold */
    -webkit-text-stroke:1px #461D7C;
    text-shadow:
      0 1px 0 #461D7C, 0 -1px 0 #461D7C,
      1px 0 0 #461D7C, -1px 0 0 #461D7C;
    letter-spacing:.03em;
  }

  /* small status line for debug */
  #status{position:absolute;left:-9999px}
  .debug #status{
    position:static;
    padding:6px 8px;
    font:12px/1.2 ui-monospace,Menlo,Consolas,monospace;
    color:#b00;
  }
</style>
</head>
<body>
<div id="status" aria-live="polite"></div>
<div class="wrap"><ol id="list"><li><span class="rk">1.</span> <span class="team">Placeholder</span></li></ol></div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);

  // read appearance params
  const h  = Number(qs.get('h') || 32);
  const bg = '#' + (qs.get('bg') || 'f5f7fa').replace('#','');
  const fg = '#' + (qs.get('fg') || '000000').replace('#','');
  document.documentElement.style.setProperty('--bar-h', h + 'px');
  document.documentElement.style.setProperty('--bg', bg);
  document.documentElement.style.setProperty('--fg', fg);

  // which poll?
  const poll = (qs.get('poll') || 'ap').toLowerCase();
  const n = Math.max(1, Math.min(Number(qs.get('n') || 10), 25));

  // Optional overrides; otherwise default to same-origin JSON files.
  const apUrlParam       = qs.get('apUrl');
  const coachesUrlParam  = qs.get('coachesUrl');

  const apDefault       = '/tcd-ap.json';
  const coachesDefault  = '/tcd-coaches.json';

  const dataUrl = poll === 'coaches'
    ? (coachesUrlParam || coachesDefault)
    : (apUrlParam || apDefault);

  const listEl = document.getElementById('list');
  const statusEl = document.getElementById('status');
  const debug = qs.get('debug') === '1';
  if (debug) document.body.classList.add('debug');

  // simple color map (optional). Add more teams as you like.
  const colorMap = new Map([
    ['Texas',      '#BF5700'],
    ['Penn State', '#041E42'],
    ['Ohio State', '#BB0000'],
    ['Clemson',    '#F56600'],
    ['Georgia',    '#BA0C2F'],
    ['Notre Dame', '#0C2340'],
    ['Oregon',     '#154733'],
    ['Alabama',    '#9E1B32'],
    ['Miami',      '#F47321'] // accent; base text stays black so it stays readable
  ]);

  function setStatus(txt){ statusEl.textContent = txt; }

  function toAbs(u){
    try { return new URL(u, location.origin).href; } catch { return u; }
  }

  async function load(){
    try{
      const href = toAbs(dataUrl);
      setStatus('Loading: ' + href);
      const r = await fetch(href, { cache:'no-store', mode:'cors' });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const json = await r.json();

      // Expect { teams: [{ rk, team, rec }] }
      const teams = (json.teams || []).slice().sort((a,b)=>(a.rk??999)-(b.rk??999)).slice(0,n);

      // Build the row
      listEl.innerHTML = '';
      for (const t of teams){
        const li = document.createElement('li');
        li.dataset.team = t.team;
        const rk = document.createElement('span');
        rk.className = 'rk'; rk.textContent = (t.rk ?? '') + '.';
        const name = document.createElement('span');
        name.className = 'team'; name.textContent = t.team;

        // apply color if known (LSU handled by CSS special above)
        const hex = colorMap.get(t.team);
        if (hex && t.team !== 'LSU') name.style.color = hex;

        li.append(rk, document.createTextNode(' '), name);
        listEl.appendChild(li);
      }
      if (!teams.length){
        throw new Error('No teams in JSON');
      }
      setStatus('OK');
    }catch(err){
      listEl.innerHTML = '<li><span class="team">Unable to load rankings.</span></li>';
      setStatus('Error: ' + (err && err.message ? err.message : String(err)));
    }
  }

  load();
})();
</script>
</body>
</html>

