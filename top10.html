<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TCD Top 10</title>
<style>
  :root{
    --h: 32px;              /* bar height (will be set from ?h=) */
    --bg: #f5f7fa;          /* background (from ?bg=) */
    --fg: #000000;          /* default text color (from ?fg=) */
    --n: 10;                /* number of teams (from ?n=) */
    --pad-x: 10px;          /* horizontal padding, scales with height */
    --gap: 10px;            /* gap between items, scales with height */
    --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  html,body{
    margin:0;
    padding:0;
    background:transparent;  /* so the embed inherits host page */
  }

  .bar{
    display:flex;
    align-items:center;
    height:var(--h);
    background:var(--bg);
    color:var(--fg);
    font-family:var(--font);
    border-radius:6px;
    box-shadow:0 0 0 1px rgba(0,0,0,.05) inset;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(var(--n), minmax(0,1fr));
    align-items:center;
    width:100%;
    padding:0 var(--pad-x);
    gap:var(--gap);
  }

  .item{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:.35rem;
    white-space:nowrap;
    line-height:1;
    font-weight:700;
    /* font-size set in JS based on --h */
  }

  .rk{
    font-variant-numeric: tabular-nums;
    opacity:.85;
    margin-right:.125rem;
  }

  .team{ color:var(--fg); }

  /* LSU special styling: gold fill, purple outline per letter, slight tracking */
  .team[data-team="LSU"]{
    color:#FFD700 !important;              /* gold letters */
    -webkit-text-stroke:1.4px #461D7C;     /* purple outline (WebKit) */
    text-shadow:                            /* outline fallback for others */
      -0.5px -0.5px 0 #461D7C,
       0.5px -0.5px 0 #461D7C,
      -0.5px  0.5px 0 #461D7C,
       0.5px  0.5px 0 #461D7C;
    letter-spacing:.4px;                    /* a “smidge” of spacing */
    font-weight:800;
  }

  /* Error state */
  .empty{
    display:flex;
    align-items:center;
    justify-content:center;
    width:100%;
    height:var(--h);
    color:var(--fg);
    opacity:.8;
    font-family:var(--font);
    font-size:14px;
  }
</style>
</head>
<body>
  <div id="bar" class="bar" role="region" aria-label="Top football teams">
    <div id="grid" class="grid" hidden></div>
    <div id="empty" class="empty" hidden>Unable to load rankings.</div>
  </div>

<script>
(function(){
  const qs = new URLSearchParams(location.search);

  // --- Params
  const poll = (qs.get("poll") || "ap").toLowerCase(); // "ap" or "coaches"
  const n = clampInt(qs.get("n"), 10, 1, 25);
  const h = clampInt(qs.get("h"), 32, 24, 60);         // px
  const bg = hexOrDefault(qs.get("bg"), "f5f7fa");
  const fg = hexOrDefault(qs.get("fg"), "000000");

  // Apply CSS variables + scale font & spacing to the height
  const r = document.documentElement;
  r.style.setProperty("--n", n);
  r.style.setProperty("--h", h + "px");
  r.style.setProperty("--bg", "#" + bg);
  r.style.setProperty("--fg", "#" + fg);
  r.style.setProperty("--pad-x", Math.max(8, Math.round(h * 0.30)) + "px");
  r.style.setProperty("--gap",   Math.max(6, Math.round(h * 0.28)) + "px");

  // Font size heuristic: readable without wrapping
  const fs = Math.max(12, Math.round(h * 0.52));
  // Apply to grid via inline style so it’s easy
  document.getElementById("grid").style.fontSize = fs + "px";

  // Data source (served as static files from this repo)
  const SRC = poll === "coaches" ? "/tcd-coaches.json" : "/tcd-ap.json";

  // Team color map (primary brand colors). Fallback to --fg if unknown.
  const COLORS = {
    "Texas":"BF5700",
    "Penn State":"041E42",
    "Ohio State":"BB0000",
    "Clemson":"F56600",
    "Georgia":"BA0C2F",
    "Notre Dame":"0C2340",
    "Oregon":"154733",
    "Alabama":"9E1B32",
    "LSU":"FFD700",           // will be overridden by special style above
    "Miami":"F47321",
    "Michigan":"00274C",
    "Florida State":"782F40",
    "USC":"990000",
    "UCLA":"0072CE",
    "Tennessee":"FF8200",
    "Washington":"4B2E83",
    "Oklahoma":"841617",
    "Florida":"FA4616",
    "Ole Miss":"CE1126",
    "Auburn":"0C2340",
    "Texas A&M":"500000",
    "Kansas State":"512888",
    "Missouri":"F1B82D",
    "North Carolina":"7BAFD4",
    "Utah":"CC0000",
    "Iowa":"000000",
    "Wisconsin":"C5050C",
    "Ole Miss Rebels":"CE1126"
  };

  fetch(SRC, {cache:"no-store"})
    .then(r => r.ok ? r.json() : Promise.reject(r.status))
    .then(json => {
      const teams = Array.isArray(json?.teams) ? json.teams : [];
      if (!teams.length) throw new Error("empty");

      const top = teams
        .slice(0, n)
        .map(t => ({ rk: t.rk ?? t.rank ?? 0, name: t.team || t.name || "" }));

      render(top);
    })
    .catch(() => showError());

  function render(list){
    const grid = document.getElementById("grid");
    grid.innerHTML = "";
    for (const t of list){
      const item = document.createElement("div");
      item.className = "item";

      const rk = document.createElement("span");
      rk.className = "rk";
      rk.textContent = (t.rk || "?") + ".";
      item.appendChild(rk);

      const team = document.createElement("span");
      team.className = "team";
      team.setAttribute("data-team", normalizeTeamKey(t.name));
      team.textContent = t.name;

      // Colorize by team if we have a mapping (except LSU, which is styled via CSS)
      if (t.name !== "LSU") {
        const hex = COLORS[t.name] || COLORS[normalizeTeamKey(t.name)];
        if (hex) team.style.color = "#" + hex;
      }
      item.appendChild(team);

      grid.appendChild(item);
    }
    grid.hidden = false;
    document.getElementById("empty").hidden = true;
  }

  function showError(){
    document.getElementById("grid").hidden = true;
    document.getElementById("empty").hidden = false;
  }

  // --- helpers
  function clampInt(v, def, min, max){
    const n = Math.floor(+v);
    return Number.isFinite(n) ? Math.min(max, Math.max(min, n)) : def;
  }

  function hexOrDefault(s, def){
    const m = (s || "").toString().trim().replace(/^#/, "");
    if (/^[0-9a-fA-F]{6}$/.test(m)) return m.toLowerCase();
    if (/^[0-9a-fA-F]{3}$/.test(m)) return m.split("").map(x=>x+x).join("").toLowerCase();
    return def.toLowerCase();
  }

  function normalizeTeamKey(name){
    // Use consistent keys for the color map
    return (name || "").replace(/\s+/g, " ").trim();
  }
})();
</script>
</body>
</html>


